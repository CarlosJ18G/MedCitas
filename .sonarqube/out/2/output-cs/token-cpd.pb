ë
BC:\Users\Usuario\Desktop\medcitas\MedCitas\MedCitas.Web\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder 
. 
Services 
. 

AddSession 
( 
options #
=>$ &
{ 
options 
. 
IdleTimeout 
= 
TimeSpan "
." #
FromMinutes# .
(. /
$num/ 1
)1 2
;2 3
options 
. 
Cookie 
. 
HttpOnly 
= 
true "
;" #
options 
. 
Cookie 
. 
IsEssential 
=  
true! %
;% &
} 
) 
; 
builder 
. 
Services 
. 
AddDbContext 
< 
MedCitasDbContext /
>/ 0
(0 1
options1 8
=>9 ;
options 
. 
	UseNpgsql 
( 
builder 
. 
Configuration +
.+ ,
GetConnectionString, ?
(? @
$str@ S
)S T
)T U
)U V
;V W
builder 
. 
Services 
. 
	AddScoped 
< 
IPacienteRepository .
,. /!
EfPacienteRepositorio0 E
>E F
(F G
)G H
;H I
builder 
. 
Services 
. 
	AddScoped 
< 
IEmailService (
,( )
FakeEmailService* :
>: ;
(; <
)< =
;= >
builder 
. 
Services 
. 
	AddScoped 
< 
PacienteService *
>* +
(+ ,
), -
;- .
var"" 
app"" 
="" 	
builder""
 
."" 
Build"" 
("" 
)"" 
;"" 
if'' 
('' 
!'' 
app'' 
.'' 	
Environment''	 
.'' 
IsDevelopment'' "
(''" #
)''# $
)''$ %
{(( 
app)) 
.)) 
UseExceptionHandler)) 
()) 
$str)) )
)))) *
;))* +
app** 
.** 
UseHsts** 
(** 
)** 
;** 
}++ 
app-- 
.-- 
UseHttpsRedirection-- 
(-- 
)-- 
;-- 
app.. 
... 
UseStaticFiles.. 
(.. 
).. 
;.. 
app// 
.// 

UseRouting// 
(// 
)// 
;// 
app00 
.00 

UseSession00 
(00 
)00 
;00 
app11 
.11 
UseAuthorization11 
(11 
)11 
;11 
app33 
.33 
MapControllerRoute33 
(33 
name44 
:44 	
$str44
 
,44 
pattern55 
:55 
$str55 5
)66 
;66 
app88 
.88 
Run88 
(88 
)88 	
;88	 
¸
PC:\Users\Usuario\Desktop\medcitas\MedCitas\MedCitas.Web\Models\ErrorViewModel.cs
	namespace 	
MedCitas
 
. 
Web 
. 
Models 
; 
public 
class 
ErrorViewModel 
{ 
public 

string 
? 
	RequestId 
{ 
get "
;" #
set$ '
;' (
}) *
public 

bool 
ShowRequestId 
=>  
!! "
string" (
.( )
IsNullOrEmpty) 6
(6 7
	RequestId7 @
)@ A
;A B
} Ð,
YC:\Users\Usuario\Desktop\medcitas\MedCitas\MedCitas.Web\Controllers\PacienteController.cs
	namespace 	
MedCitas
 
. 
Web 
. 
Controllers "
{ 
public		 

class		 
PacienteController		 #
:		$ %

Controller		& 0
{

 
private 
readonly 
PacienteService (
_pacienteService) 9
;9 :
public 
PacienteController !
(! "
PacienteService" 1
pacienteService2 A
)A B
{ 	
_pacienteService 
= 
pacienteService .
;. /
} 	
[ 	
HttpGet	 
] 
public 
IActionResult 
Registro %
(% &
)& '
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Registro) 1
(1 2
Paciente2 :
model; @
,@ A
stringB H
passwordI Q
,Q R
stringS Y
confirmarPasswordZ k
)k l
{   	
try!! 
{"" 
if## 
(## 
!## 

ModelState## 
.##  
IsValid##  '
)##' (
return$$ 
View$$ 
($$  
model$$  %
)$$% &
;$$& '
var&& 
nuevoPaciente&& !
=&&" #
await&&$ )
_pacienteService&&* :
.&&: ;
RegistrarAsync&&; I
(&&I J
model&&J O
,&&O P
password&&Q Y
,&&Y Z
confirmarPassword&&[ l
)&&l m
;&&m n
ViewBag(( 
.(( 
Mensaje(( 
=((  !
$str((" ^
;((^ _
return)) 
View)) 
()) 
$str)) -
,))- .
nuevoPaciente))/ <
)))< =
;))= >
}** 
catch++ 
(++ 
	Exception++ 
ex++ 
)++  
{,, 
ViewBag-- 
.-- 
Error-- 
=-- 
ex--  "
.--" #
Message--# *
;--* +
return.. 
View.. 
(.. 
model.. !
)..! "
;.." #
}// 
}00 	
[55 	
HttpGet55	 
]55 
public66 
IActionResult66 
Login66 "
(66" #
)66# $
{77 	
return88 
View88 
(88 
)88 
;88 
}99 	
[>> 	
HttpPost>>	 
]>> 
public?? 
async?? 
Task?? 
<?? 
IActionResult?? '
>??' (
Login??) .
(??. /
string??/ 5
correoElectronico??6 G
,??G H
string??I O
password??P X
)??X Y
{@@ 	
tryAA 
{BB 
varCC 
pacienteCC 
=CC 
awaitCC $
_pacienteServiceCC% 5
.CC5 6

LoginAsyncCC6 @
(CC@ A
correoElectronicoCCA R
,CCR S
passwordCCT \
)CC\ ]
;CC] ^
ifEE 
(EE 
pacienteEE 
==EE 
nullEE  $
)EE$ %
{FF 
ViewBagGG 
.GG 
ErrorGG !
=GG" #
$strGG$ ?
;GG? @
returnHH 
ViewHH 
(HH  
)HH  !
;HH! "
}II 
HttpContextKK 
.KK 
SessionKK #
.KK# $
	SetStringKK$ -
(KK- .
$strKK. :
,KK: ;
pacienteKK< D
.KKD E
IdKKE G
.KKG H
ToStringKKH P
(KKP Q
)KKQ R
)KKR S
;KKS T
HttpContextLL 
.LL 
SessionLL #
.LL# $
	SetStringLL$ -
(LL- .
$strLL. >
,LL> ?
pacienteLL@ H
.LLH I
NombreCompletoLLI W
)LLW X
;LLX Y
returnNN 
RedirectToActionNN '
(NN' (
$strNN( /
,NN/ 0
$strNN1 7
)NN7 8
;NN8 9
}OO 
catchPP 
(PP 
	ExceptionPP 
exPP 
)PP  
{QQ 
ViewBagRR 
.RR 
ErrorRR 
=RR 
exRR  "
.RR" #
MessageRR# *
;RR* +
returnSS 
ViewSS 
(SS 
)SS 
;SS 
}TT 
}UU 	
[ZZ 	
HttpGetZZ	 
]ZZ 
[[[ 	
Route[[	 
([[ 
$str[[ 1
)[[1 2
][[2 3
public\\ 
async\\ 
Task\\ 
<\\ 
IActionResult\\ '
>\\' (
VerificarCuenta\\) 8
(\\8 9
string\\9 ?
token\\@ E
)\\E F
{]] 	
var^^ 
result^^ 
=^^ 
await^^ 
_pacienteService^^ /
.^^/ 0
ActivarCuentaAsync^^0 B
(^^B C
token^^C H
)^^H I
;^^I J
ViewBag__ 
.__ 
	Resultado__ 
=__ 
result__  &
?__' (
$str__) I
:__J K
$str__L h
;__h i
return`` 
View`` 
(`` 
)`` 
;`` 
}aa 	
}bb 
}cc ý
UC:\Users\Usuario\Desktop\medcitas\MedCitas\MedCitas.Web\Controllers\HomeController.cs
	namespace 	
MedCitas
 
. 
Web 
. 
Controllers "
;" #
public 
class 
HomeController 
: 

Controller (
{ 
private		 
readonly		 
ILogger		 
<		 
HomeController		 +
>		+ ,
_logger		- 4
;		4 5
public 

HomeController 
( 
ILogger !
<! "
HomeController" 0
>0 1
logger2 8
)8 9
{ 
_logger 
= 
logger 
; 
} 
public 

IActionResult 
Index 
( 
)  
{ 
return 
View 
( 
) 
; 
} 
public 

IActionResult 
Privacy  
(  !
)! "
{ 
return 
View 
( 
) 
; 
} 
[ 
ResponseCache 
( 
Duration 
= 
$num 
,  
Location! )
=* +!
ResponseCacheLocation, A
.A B
NoneB F
,F G
NoStoreH O
=P Q
trueR V
)V W
]W X
public 

IActionResult 
Error 
( 
)  
{ 
return 
View 
( 
new 
ErrorViewModel &
{' (
	RequestId) 2
=3 4
Activity5 =
.= >
Current> E
?E F
.F G
IdG I
??J L
HttpContextM X
.X Y
TraceIdentifierY h
}i j
)j k
;k l
} 
} 